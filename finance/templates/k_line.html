{% load staticfiles %}<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>K线图</title>    <script type="application/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>    <script type="application/javascript" src="{% static 'js/echarts.js' %}"></script>    <link rel="stylesheet" type="text/css" href="{% static 'css/semantic.min.css' %}"></head><body>{% if show %}    <div class="menu">        <table class="ui celled table">            <thead>            <tr>                <th>名称</th>                <th>最新价</th>                {#            <th>涨跌</th>#}                <th>开盘价</th>                {#            <th>昨收价</th>#}                <th>最高价</th>                <th>最低价</th>                <th>报价时间</th>            </tr>            </thead>            <tbody>            <tr>                <td>{{ name }}</td>                <td>{{ price|floatformat:2 }}</td>                <td>{{ open|floatformat:2 }}</td>                <td>{{ height_price|floatformat:2 }}</td>                <td>{{ low|floatformat:2 }}</td>                <td>{{ time }}</td>            </tr>        </table>        <div class="buttons">            <a href="{% url 'finance:ticks' code %}?height={{ height }}" class="ui mini button ticks active">分时</a>            <a href="{% url 'finance:day k line' code %}?type=D&height={{ height }}" class="ui mini button {% if type == 'D' %}active{% endif %}">日K</a>            <a href="{% url 'finance:day k line' code %}?type=W&height={{ height }}" class="ui mini button {% if type == 'W' %}active{% endif %}">周线</a>            <a href="{% url 'finance:day k line' code %}?type=M&height={{ height }}" class="ui mini button {% if type == 'M' %}active{% endif %}">月线</a>            <a href="{% url 'finance:day k line' code %}?type=5&height={{ height }}" class="ui mini button {% if type == '5' %}active{% endif %}">5分钟</a>            <a href="{% url 'finance:day k line' code %}?type=15&height={{ height }}" class="ui mini button {% if type == '15' %}active{% endif %}">15分钟</a>            <a href="{% url 'finance:day k line' code %}?type=30&height={{ height }}" class="ui mini button {% if type == '30' %}active{% endif %}">30分钟</a>            <a href="{% url 'finance:day k line' code %}?type=60&height={{ height }}" class="ui mini button {% if type == '60' %}active{% endif %}">60分钟</a>        </div>    </div>{% endif %}<div id="content" style="height:{{ height }}px;"></div></body></html><script src="{% static 'js/echarts-all.min.js' %}"></script><script>    $(function () {        var myChart = echarts.init(document.getElementById('content'));        myChart.showLoading({            text: '暂无数据',            effect: 'bubble',            textStyle: {                fontSize: 30            }        });        var get_time = function (data) {            return data.map(function (item) {                return item['time'];            })        };        var format_data = function(data){              return data.map(function (item) {                return item['nowPrice'];            })        }        var get_tick_data = function () {            option = {                tooltip: {                    trigger: 'axis',                    axisPointer: {                        type: 'line'                    },                    formatter: function (param) {                        var param = param[0];                        var tooltip_info = '时间：' + datas[param.dataIndex].time + '<br>' +                            '价格：' + datas[param.dataIndex].nowPrice + '<br>' +                            '成交：' + datas[param.dataIndex].volume + '<br>' +                            '均价：' + datas[param.dataIndex].avgPrice + '<br>';                        return tooltip_info                    }                },                dataZoom: [                    {                        show: true,                        realtime: true,                        start: {{ start }},                        end: {{ end }}                    }                ],                xAxis: {                    data: []                },                yAxis: {                    scale: true,                    axisLine: {lineStyle: {color: '#8392A5'}},                },                series: [{                    showSymbol: false,                    hoverAnimation: false,                    type: 'line',                    data: [],                    lineStyle: {                        normal: {                            width: 1                        }                    }                }]            };            myChart.setOption(option);            var get_datas = function () {                $.get('{% url "finance:get k ticks data" code %}', function (data) {                    if (!data) {                        myChart.showLoading({                            text: '无数据' //loading话术                        });                        return;                    }                    myChart.hideLoading();//隐藏loading                    datas = data['data']['showapi_res_body']['dataList'][0]['minuteList']                    var point = data['point'];                    if (!!{{ show_point }}) {                        myChart.setOption({                            xAxis: {                                data: get_time(datas)                            },                            series: [{                                data: [],                                markPoint: {                                    label: {                                        normal: {                                            formatter: function (param) {                                                return param.name;                                            }                                        }                                    },                                    data: point,                                    tooltip: {                                        formatter: function (param) {                                            return param.name + '<br>' + (param.data.coord[1]);                                        }                                    }                                }                            }]                        });                    } else {                        myChart.setOption({                            xAxis: {                                data: get_time(datas)                            },                            series: [{                                data: format_data(datas),                            }]                        });                    }                })            }            myChart.showLoading({                text: '数据正在加载中' //loading话术            });            get_datas()            setInterval(function () {                get_datas()            }, 1000 * 60);        }        get_tick_data()        $(window).resize(function () {            myChart.resize();        });    });</script>