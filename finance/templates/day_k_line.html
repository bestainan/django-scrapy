{% load staticfiles %}<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>K线图</title>    <script type="application/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>    <script type="application/javascript" src="{% static 'js/echarts.js' %}"></script>    <link rel="stylesheet" type="text/css" href="{% static 'css/semantic.min.css' %}"></head><body>{% if show %}    <div class="menu">        <table class="ui celled table">            <thead>            <tr>                <th>名称</th>                <th>最新价</th>                {#            <th>涨跌</th>#}                <th>开盘价</th>                {#            <th>昨收价</th>#}                <th>最高价</th>                <th>最低价</th>                <th>报价时间</th>            </tr>            </thead>            <tbody>            <tr>                <td>{{ name }}</td>                <td>{{ price|floatformat:2 }}</td>                <td>{{ open|floatformat:2 }}</td>                <td>{{ height|floatformat:2 }}</td>                <td>{{ low|floatformat:2 }}</td>                <td>{{ time }}</td>            </tr>        </table>        <div class="buttons">            <a href="{% url 'finance:ticks' code %}" class="ui mini button ticks">分时</a>            <a href="{% url 'finance:day k line' code %}?type=D" class="ui mini button {% if type == 'D' %}active{% endif %}">日K</a>            <a href="{% url 'finance:day k line' code %}?type=W" class="ui mini button {% if type == 'W' %}active{% endif %}">周线</a>            <a href="{% url 'finance:day k line' code %}?type=M" class="ui mini button {% if type == 'M' %}active{% endif %}">月线</a>            <a href="{% url 'finance:day k line' code %}?type=5" class="ui mini button {% if type == '5' %}active{% endif %}">5分钟</a>            <a href="{% url 'finance:day k line' code %}?type=15" class="ui mini button {% if type == '15' %}active{% endif %}">15分钟</a>            <a href="{% url 'finance:day k line' code %}?type=30" class="ui mini button {% if type == '30' %}active{% endif %}">30分钟</a>            <a href="{% url 'finance:day k line' code %}?type=60" class="ui mini button {% if type == '60' %}active{% endif %}">60分钟</a>        </div>    </div>{% endif %}<div id="content" style="height:500px;"></div></body></html><script src="{% static 'js/echarts-all.min.js' %}"></script><script>    $(function () {        var myChart = echarts.init(document.getElementById('content'));        {#      数据意义：开盘(open)，收盘(close)，最低(lowest)，最高(highest)#}        var data0 = splitData({{ data|safe }});        function splitData(rawData) {            var categoryData = [];            var values = []            for (var i = 0; i < rawData.length; i++) {                categoryData.push(rawData[i].splice(0, 1)[0]);                values.push(rawData[i])            }            return {                categoryData: categoryData,                values: values            };        }        function calculateMA(dayCount) {            var result = [];            for (var i = 0, len = data0.values.length; i < len; i++) {                if (i < dayCount) {                    result.push('-');                    continue;                }                var sum = 0;                for (var j = 0; j < dayCount; j++) {                    sum += data0.values[i - j][1];                }                result.push((sum / dayCount).toFixed(2));            }            return result;        }        option = {            tooltip: {                trigger: 'axis',                axisPointer: {                    type: 'line'                }            },            legend: {                data: ['{{ name }}', 'MA5', 'MA10', 'MA20', 'MA30']            },            grid: {                left: '10%',                right: '10%',                bottom: '15%'            },            xAxis: {                type: 'category',                data: data0.categoryData,                scale: true,                boundaryGap: false,                axisLine: {onZero: false},                splitLine: {show: false},                splitNumber: 20,                min: 'dataMin',                max: 'dataMax'            },            yAxis: {                scale: true,                splitArea: {                    show: true                }            },            dataZoom: [                {                    type: 'inside',                    start: 50,                    end: 100                },                {                    show: true,                    type: 'slider',                    y: '90%',                    start: 50,                    end: 100                }            ],            series: [                {                    name: '{{ name }}',                    type: 'candlestick',                    data: data0.values,                    markPoint: {                        label: {                            normal: {                                formatter: function (param) {                                    return param != null ? Math.round(param.value) : '';                                }                            }                        },                        data: [                            {                                name: '最高价',                                type: 'max',                                valueDim: 'highest'                            },                            {                                name: '最低价',                                type: 'min',                                valueDim: 'lowest'                            },                            {                                name: '平均收盘价',                                type: 'average',                                valueDim: 'close'                            }                        ],                        tooltip: {                            formatter: function (param) {                                return param.name + '<br>' + (param.data.coord || '');                            }                        }                    },                    markLine: {                        symbol: ['none', 'none'],                        data: [                            [                                {                                    name: '最低到最高',                                    type: 'min',                                    valueDim: 'lowest',                                    symbol: 'circle',                                    symbolSize: 10,                                    label: {                                        normal: {show: false},                                        emphasis: {show: false}                                    }                                },                                {                                    type: 'max',                                    valueDim: 'highest',                                    symbol: 'circle',                                    symbolSize: 10,                                    label: {                                        normal: {show: false},                                        emphasis: {show: false}                                    }                                }                            ],                            {                                name: '最小收盘价',                                type: 'min',                                valueDim: 'close'                            },                            {                                name: '最高收盘',                                type: 'max',                                valueDim: 'close'                            }                        ]                    }                },                {                    name: 'MA5',                    type: 'line',                    data: calculateMA(5),                    smooth: true,                    lineStyle: {                        normal: {opacity: 0.5}                    }                },                {                    name: 'MA10',                    type: 'line',                    data: calculateMA(10),                    smooth: true,                    lineStyle: {                        normal: {opacity: 0.5}                    }                },                {                    name: 'MA20',                    type: 'line',                    data: calculateMA(20),                    smooth: true,                    lineStyle: {                        normal: {opacity: 0.5}                    }                },                {                    name: 'MA30',                    type: 'line',                    data: calculateMA(30),                    smooth: true,                    lineStyle: {                        normal: {opacity: 0.5}                    }                },            ]        };        myChart.setOption(option)        $(window).resize(function () {            myChart.resize();        });    });</script>